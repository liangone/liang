{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{477:function(t,s,n){\"use strict\";n.r(s);var a=n(12),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"_08-说说对-node-js-中的事件循环机制理解\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_08-说说对-node-js-中的事件循环机制理解\"}},[t._v(\"#\")]),t._v(\" 08.说说对 Node.js 中的事件循环机制理解?\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/IceRain-mvc/cdn/img/640-20210928155323037\",alt:\"图片\"}})]),t._v(\" \"),s(\"h2\",{attrs:{id:\"一、是什么\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#一、是什么\"}},[t._v(\"#\")]),t._v(\" 一、是什么\")]),t._v(\" \"),s(\"p\",[t._v(\"在\"),s(\"a\",{attrs:{href:\"http://mp.weixin.qq.com/s?__biz=MzU1OTgxNDQ1Nw==&mid=2247486000&idx=2&sn=c5f1993637df1df0f4b2721f0f7e4692&chksm=fc10c866cb674170e06f497617331bb3c227c85aba21220ac6a234a6da51cdd8565e42b68749&scene=21#wechat_redirect\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"浏览器事件循环\"),s(\"OutboundLink\")],1),t._v(\"中，我们了解到\"),s(\"code\",[t._v(\"javascript\")]),t._v(\"在浏览器中的事件循环机制，其是根据\"),s(\"code\",[t._v(\"HTML5\")]),t._v(\"定义的规范来实现\")]),t._v(\" \"),s(\"p\",[t._v(\"而在\"),s(\"code\",[t._v(\"NodeJS\")]),t._v(\"中，事件循环是基于\"),s(\"code\",[t._v(\"libuv\")]),t._v(\"实现，\"),s(\"code\",[t._v(\"libuv\")]),t._v(\"是一个多平台的专注于异步IO的库，如下图最右侧所示：\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/IceRain-mvc/cdn/img/640-20210928155330621\",alt:\"图片\"}})]),t._v(\" \"),s(\"p\",[t._v(\"上图\"),s(\"code\",[t._v(\"EVENT_QUEUE\")]),t._v(\" 给人看起来只有一个队列，但\"),s(\"code\",[t._v(\"EventLoop\")]),t._v(\"存在6个阶段，每个阶段都有对应的一个先进先出的回调队列\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"二、流程\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#二、流程\"}},[t._v(\"#\")]),t._v(\" 二、流程\")]),t._v(\" \"),s(\"p\",[t._v(\"上节讲到事件循环分成了六个阶段，对应如下：\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/IceRain-mvc/cdn/img/640-20210928155334497\",alt:\"图片\"}})]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"timers阶段：这个阶段执行timer（setTimeout、setInterval）的回调\")]),t._v(\" \"),s(\"li\",[t._v(\"定时器检测阶段(timers)：本阶段执行 timer 的回调，即 setTimeout、setInterval 里面的回调函数\")]),t._v(\" \"),s(\"li\",[t._v(\"I/O事件回调阶段(I/O callbacks)：执行延迟到下一个循环迭代的 I/O 回调，即上一轮循环中未被执行的一些I/O回调\")]),t._v(\" \"),s(\"li\",[t._v(\"闲置阶段(idle, prepare)：仅系统内部使用\")]),t._v(\" \"),s(\"li\",[t._v(\"轮询阶段(poll)：检索新的 I/O 事件;执行与 I/O 相关的回调（几乎所有情况下，除了关闭的回调函数，那些由计时器和 setImmediate() 调度的之外），其余情况 node 将在适当的时候在此阻塞\")]),t._v(\" \"),s(\"li\",[t._v(\"检查阶段(check)：setImmediate() 回调函数在这里执行\")]),t._v(\" \"),s(\"li\",[t._v(\"关闭事件回调阶段(close callback)：一些关闭的回调函数，如：socket.on('close', ...)\")])]),t._v(\" \"),s(\"p\",[t._v(\"每个阶段对应一个队列，当事件循环进入某个阶段时, 将会在该阶段内执行回调，直到队列耗尽或者回调的最大数量已执行, 那么将进入下一个处理阶段\")]),t._v(\" \"),s(\"p\",[t._v(\"除了上述6个阶段，还存在\"),s(\"code\",[t._v(\"process.nextTick\")]),t._v(\"，其不属于事件循环的任何一个阶段，它属于该阶段与下阶段之间的过渡, 即本阶段执行结束, 进入下一个阶段前, 所要执行的回调，类似插队\")]),t._v(\" \"),s(\"p\",[t._v(\"流程图如下所示：\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://cdn.jsdelivr.net/gh/IceRain-mvc/cdn/img/640-20210928155338582\",alt:\"图片\"}})]),t._v(\" \"),s(\"p\",[t._v(\"在\"),s(\"code\",[t._v(\"Node\")]),t._v(\"中，同样存在宏任务和微任务，与浏览器中的事件循环相似\")]),t._v(\" \"),s(\"p\",[t._v(\"微任务对应有：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"next tick queue：process.nextTick\")]),t._v(\" \"),s(\"li\",[t._v(\"other queue：Promise的then回调、queueMicrotask\")])]),t._v(\" \"),s(\"p\",[t._v(\"宏任务对应有：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"timer queue：setTimeout、setInterval\")]),t._v(\" \"),s(\"li\",[t._v(\"poll queue：IO事件\")]),t._v(\" \"),s(\"li\",[t._v(\"check queue：setImmediate\")]),t._v(\" \"),s(\"li\",[t._v(\"close queue：close事件\")])]),t._v(\" \"),s(\"p\",[t._v(\"其执行顺序为：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"next tick microtask queue\")]),t._v(\" \"),s(\"li\",[t._v(\"other microtask queue\")]),t._v(\" \"),s(\"li\",[t._v(\"timer queue\")]),t._v(\" \"),s(\"li\",[t._v(\"poll queue\")]),t._v(\" \"),s(\"li\",[t._v(\"check queue\")]),t._v(\" \"),s(\"li\",[t._v(\"close queue\")])]),t._v(\" \"),s(\"h2\",{attrs:{id:\"三、题目\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#三、题目\"}},[t._v(\"#\")]),t._v(\" 三、题目\")]),t._v(\" \"),s(\"p\",[t._v(\"通过上面的学习，下面开始看看题目\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"async\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"async1\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'async1 start'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"await\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"async2\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n    console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'async1 end'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"async\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"async2\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'async2'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\nconsole\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'script start'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"setTimeout\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'setTimeout0'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"setTimeout\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'setTimeout2'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"300\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"setImmediate\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'setImmediate'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\nprocess\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"nextTick\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'nextTick1'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"async1\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\nprocess\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"nextTick\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'nextTick2'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"Promise\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token parameter\"}},[t._v(\"resolve\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'promise1'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"resolve\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n    console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'promise2'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"then\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'promise3'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\nconsole\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'script end'\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"分析过程：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"先找到同步任务，输出script start\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到第一个 setTimeout，将里面的回调函数放到 timer 队列中\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到第二个 setTimeout，300ms后将里面的回调函数放到 timer 队列中\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到第一个setImmediate，将里面的回调函数放到 check 队列中\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到第一个 nextTick，将其里面的回调函数放到本轮同步任务执行完毕后执行\")]),t._v(\" \"),s(\"li\",[t._v(\"执行 async1函数，输出 async1 start\")]),t._v(\" \"),s(\"li\",[t._v(\"执行 async2 函数，输出 async2，async2 后面的输出 async1 end进入微任务，等待下一轮的事件循环\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到第二个，将其里面的回调函数放到本轮同步任务执行完毕后执行\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到 new Promise，执行里面的立即执行函数，输出 promise1、promise2\")]),t._v(\" \"),s(\"li\",[t._v(\"then里面的回调函数进入微任务队列\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到同步任务，输出 script end\")]),t._v(\" \"),s(\"li\",[t._v(\"执行下一轮回到函数，先依次输出 nextTick 的函数，分别是 nextTick1、nextTick2\")]),t._v(\" \"),s(\"li\",[t._v(\"然后执行微任务队列，依次输出 async1 end、promise3\")]),t._v(\" \"),s(\"li\",[t._v(\"执行timer 队列，依次输出 setTimeout0\")]),t._v(\" \"),s(\"li\",[t._v(\"接着执行 check  队列，依次输出 setImmediate\")]),t._v(\" \"),s(\"li\",[t._v(\"300ms后，timer 队列存在任务，执行输出 setTimeout2\")])]),t._v(\" \"),s(\"p\",[t._v(\"执行结果如下：\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[t._v(\"script start\\nasync1 start\\nasync2\\npromise1\\npromise2\\nscript end\\nnextTick1\\nnextTick2\\nasync1 end\\npromise3\\nsetTimeout0\\nsetImmediate\\nsetTimeout2\\n\")])])]),s(\"p\",[t._v(\"最后有一道是关于\"),s(\"code\",[t._v(\"setTimeout\")]),t._v(\"与\"),s(\"code\",[t._v(\"setImmediate\")]),t._v(\"的输出顺序\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"setTimeout\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"setTimeout\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"setImmediate\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  console\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"setImmediate\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"输出情况如下：\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[t._v(\"情况一：\\nsetTimeout\\nsetImmediate\\n\\n情况二：\\nsetImmediate\\nsetTimeout\\n\")])])]),s(\"p\",[t._v(\"分析下流程：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"外层同步代码一次性全部执行完，遇到异步API就塞到对应的阶段\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到\"),s(\"code\",[t._v(\"setTimeout\")]),t._v(\"，虽然设置的是0毫秒触发，但实际上会被强制改成1ms，时间到了然后塞入\"),s(\"code\",[t._v(\"times\")]),t._v(\"阶段\")]),t._v(\" \"),s(\"li\",[t._v(\"遇到\"),s(\"code\",[t._v(\"setImmediate\")]),t._v(\"塞入\"),s(\"code\",[t._v(\"check\")]),t._v(\"阶段\")]),t._v(\" \"),s(\"li\",[t._v(\"同步代码执行完毕，进入Event Loop\")]),t._v(\" \"),s(\"li\",[t._v(\"先进入\"),s(\"code\",[t._v(\"times\")]),t._v(\"阶段，检查当前时间过去了1毫秒没有，如果过了1毫秒，满足\"),s(\"code\",[t._v(\"setTimeout\")]),t._v(\"条件，执行回调，如果没过1毫秒，跳过\")]),t._v(\" \"),s(\"li\",[t._v(\"跳过空的阶段，进入check阶段，执行\"),s(\"code\",[t._v(\"setImmediate\")]),t._v(\"回调\")])]),t._v(\" \"),s(\"p\",[t._v(\"这里的关键在于这1ms，如果同步代码执行时间较长，进入\"),s(\"code\",[t._v(\"Event Loop\")]),t._v(\"的时候1毫秒已经过了，\"),s(\"code\",[t._v(\"setTimeout\")]),t._v(\"先执行，如果1毫秒还没到，就先执行了\"),s(\"code\",[t._v(\"setImmediate\")])])])}),[],!1,null,null,null);s.default=e.exports}}]);","extractedComments":[]}